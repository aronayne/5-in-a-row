<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<style>
body {
    font: normal 14px Verdana, Arial, sans-serif;
}
</style>
    <script>
        $(document).ready(function() {

            $(".game").hide();
            $("#p1Text").show();
            $("#p2Text").hide();
            $("#waiting").hide();
            $("#sendMoveDiv").hide();

            $.get("/game/reset", function(data, status) {});

            // Send the move to service endpoint
            $("#sendMove").click(function() {
                $.get("/player/move", {
                    colPosition: $('#colPosition').val(),
                    rowPosition: $('#rowPosition').val(),
                    playername: $('#player1name').val()
                }, function(data, status) {
                    $(".game").empty();
                    console.log('data.board' + data.board)
                    console.log('data.player : ' + data.player)
                    $.each(data.board, function(index, value) {
                        line = '<br>'
                        $.each(value, function(index, value2) {
                            line = line + '[' + value2 + ']'
                            //console.log( index + ": " + '['+value2+']' );
                        })
                        line = line + '<br>'
                        console.log('line' + line)
                        $('.game').append(line);
                        $("#sendMoveDiv").show();


                    });

                    // For each move determine if the game has been won and update the UI accordingly
                    if (data.isWin == true) {
                        $.get("/player/winner", function(data, status) {

                            $('.game').append("<div>Player" + data.winner + " has won, refresh this page to begin a new game</div>");
                        })
                    } else {
                        $('.game').append("<div>Player" + data.player + " , its your turn </div>");
                    }
                });
            });

            // Add first player to the game
            $("#player1Add").click(function() {
                $.get("/player/add", {
                    playername: $('#player1name').val()
                }, function(data, status) {

                    $.get("/player/numberplayers", function(data, status) {

                        if (data.numberplayers == 1) {
                            $("#waiting").show();
                            $("#p1Text").hide();
                            $("#p2Text").show();

                        }
                    });

                });
            });

            // Add second player to the game
            $("#player2Add").click(function() {
                $.get("/player/add", {
                    playername: $('#player2name').val()
                }, function(data, status) {

                    $.get("/player/numberplayers", function(data, status) {

                        if (data.numberplayers == 2) {
                            $("#waiting").hide();
                            $("#p1Text").hide();
                            $("#p2Text").hide();
                            $(".game").show();

                            $.get("/game/state", function(data, status) {
                                // alert("Data: " + data);
                                console.log('data.board' + data.board)
                                console.log('data.player : ' + data.player)
                                $.each(data.board, function(index, value) {
                                    line = '<br>'
                                    $.each(value, function(index, value2) {
                                        line = line + '[' + value2 + ']'
                                        //console.log( index + ": " + '['+value2+']' );
                                    })
                                    line = line + '<br>'
                                    console.log('line' + line)
                                    $('.game').append(line);
                                });

                            });
                            $('.game').append("<div>Player " + $('#player1name').val() + ", its your turn </div>");
                            $("#sendMoveDiv").show();
                        }
                    });

                });
            });

        });
    </script>
</head>

<body>

    <center>

        <div>
            <header>
                <h1>5-in-a-row challenge</h1>
            </header>


        </div>

        <div id="waiting">
            Waiting for another player
        </div>

        <div id="p1Text">
            Player1 name: <input type="text" id="player1name"><button id="player1Add">Add</button>
        </div>
        <div id="p2Text">
            Player2  name <input type="text" id="player2name"><button id="player2Add">Add</button>
        </div>


        <div class="game">
            <div id="p1">
            </div>
        </div>

        <div id="sendMoveDiv">
            Row Position <input type="text" size="2" id="rowPosition">
            Column Position <input type="text" size="2" id="colPosition">

            <button id="sendMove">Send Move</button>

    </center>

    </div>


    <h1>Notes : </h1>

    <h2>Installation</h2>

    <ul>
        <li>Install Node.js from https://nodejs.org/en/download/ .</li>
        <li>From technical-challenge folder execute 1. 'npm install' , 2. 'node server.js' .</li>
        <li>By default the application runs on port 3000.</li>
<li>Instance of this application is running on Amazon Lightsail instance <a href="http://18.130.213.20:3000">here</a></li> 
        <li>Project source pushed to Github: <a href="https://github.com/aronayne/5-in-a-row">here</a></li>
        <li>Tested on Google Chrome & Firefox</li>
    </ul>

    <h2>Running the application</h2>

    <ul>
        <li>Refreshing this page will restart the application.</li>


        <li> On visiting homepage the first user is assigned name 'Player1', second user is assigned 'Player2'
        </li>

        <li>Unit tests are executed as part of running the application, tests are located in file server.js and exectued within function 'applictionTests()'</li>

    </ul>

    <h2>Assumptions</h2>

    <ul>
        <li> Using HTTP rest as this is mentioned in document. Ideally would utiize websockets in order for this application to be stateless. Assumed websockets not required as use ws protocol instead of http.</li>
        <li>Assumption is game is played from single client machine and not multiple machines.</li>

    </ul>

    </div>